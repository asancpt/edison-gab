---
# bibliography: 'bib/manual.bib'
output:
  html_document:
    keep_md: yes
    toc: yes
---



# PK09 - Modeling of fraction absorbed and nonlinear bioavailability across the liver

이 예제는 Pharmacokinetic and Pharmacodynamic Data Analysis 교과서의 예제입니다.  
소스 코드는 [깃헙](https://github.com/asancpt/edison-gab)에 올라와 있습니다.
에디슨 앱은 <https://www.edison.re.kr/simulation> 에서 확인할 수 있습니다.


```r
# setwd("D:/Gab (2)")

dPK09 = read.csv("data-raw/PK09.csv", skip=1, as.is=TRUE)
colnames(dPK09) = c("TIME", "DV", "CMT") ; dPK09
```

```
##        TIME      DV CMT
## 1   0.03333    4.77   1
## 2   0.13333    3.43   1
## 3   0.25000     2.7   1
## 4   0.75000    2.28   1
## 5   1.00000 missing   1
## 6   2.00000    2.57   1
## 7   3.00000 missing   1
## 8   4.00000    2.06   1
## 9   6.00000    1.97   1
## 10  8.00000    1.36   1
## 11 10.00000 missing   1
## 12 12.00000 missing   1
## 13 15.00000 missing   1
## 14 20.00000   0.191   1
## 15 23.00000  0.0478   1
## 16  0.08333   0.952   2
## 17  0.25000    3.62   2
## 18  0.50000     3.3   2
## 19  1.00000    2.75   2
## 20  2.00000    2.57   2
## 21  4.00000    2.51   2
## 22  6.00000    2.25   2
## 23  8.00000    1.96   2
## 24 23.00000   0.141   2
```

```r
dPK09 = dPK09[dPK09[,"DV"] != "missing",] ; dPK09
```

```
##        TIME     DV CMT
## 1   0.03333   4.77   1
## 2   0.13333   3.43   1
## 3   0.25000    2.7   1
## 4   0.75000   2.28   1
## 6   2.00000   2.57   1
## 8   4.00000   2.06   1
## 9   6.00000   1.97   1
## 10  8.00000   1.36   1
## 14 20.00000  0.191   1
## 15 23.00000 0.0478   1
## 16  0.08333  0.952   2
## 17  0.25000   3.62   2
## 18  0.50000    3.3   2
## 19  1.00000   2.75   2
## 20  2.00000   2.57   2
## 21  4.00000   2.51   2
## 22  6.00000   2.25   2
## 23  8.00000   1.96   2
## 24 23.00000  0.141   2
```

```r
dPK09[,"DV"] = as.numeric(dPK09[,"DV"]) ; dPK09
```

```
##        TIME     DV CMT
## 1   0.03333 4.7700   1
## 2   0.13333 3.4300   1
## 3   0.25000 2.7000   1
## 4   0.75000 2.2800   1
## 6   2.00000 2.5700   1
## 8   4.00000 2.0600   1
## 9   6.00000 1.9700   1
## 10  8.00000 1.3600   1
## 14 20.00000 0.1910   1
## 15 23.00000 0.0478   1
## 16  0.08333 0.9520   2
## 17  0.25000 3.6200   2
## 18  0.50000 3.3000   2
## 19  1.00000 2.7500   2
## 20  2.00000 2.5700   2
## 21  4.00000 2.5100   2
## 22  6.00000 2.2500   2
## 23  8.00000 1.9600   2
## 24 23.00000 0.1410   2
```

```r
# Dosing
# infusion 2 / 0.0056hr
# oral 6

QH = 3.3
VH = 0.02

require(deSolve)
```

```
## Loading required package: deSolve
```

```r
ivPKde = function(t, y, p)
{
  if (t < 0.0056) {
    RateIn = 357.1429 # 2/0.0056
  } else {
    RateIn = 0
  }
  CL = p["Vmax"]/(p["Km"] + y[4])
  dy1dt = -p["Ka"]*y[1]                           # absorption, gut comp
  dy2dt = (RateIn - QH*(y[2] - y[4]) - p["Cld"]*(y[2] - y[3]))/p["Vc"] # central, plasma
  dy3dt = (p["Cld"]*(y[2] - y[3]))/p["Vt"]                # peripheral, tissue
  dy4dt = (p["Ka"]*y[1] + QH*(y[2] - y[4]) - CL*y[4])/VH  # hepatic comp
  return(list(c(dy1dt, dy2dt, dy3dt, dy4dt)))
}

poPKde = function(t, y, p)
{
  CL = p["Vmax"]/(p["Km"] + y[4])
  if (t < p["Tlag"]) {
    Ka = 0
  } else {
    Ka = p["Ka"]
  }
  dy1dt = -Ka*y[1]                           # absorption, gut comp
  dy2dt = (-QH*(y[2] - y[4]) - p["Cld"]*(y[2] - y[3]))/p["Vc"] # central, plasma
  dy3dt = (p["Cld"]*(y[2] - y[3]))/p["Vt"]                # peripheral, tissue
  dy4dt = (Ka*y[1] + QH*(y[2] - y[4]) - CL*y[4])/VH  # hepatic comp
  return(list(c(dy1dt, dy2dt, dy3dt, dy4dt)))
}

Dpo = 6

Times1 = c(0, dPK09[dPK09[,"CMT"]==1,"TIME"]) # IV dosing
iTime1 = 2:length(Times1)
lsoda(y=c(0, 0, 0, 0), times=Times1, func=ivPKde, parms=c(Vc=0.34, Cld=1.84, Vt=0.38, Vmax=0.13, Km=0.31, Ka=11.3, Tlag=0.062))
```

```
##        time             1          2          3          4
## 1   0.00000  0.000000e+00 0.00000000 0.00000000 0.00000000
## 2   0.03333  0.000000e+00 4.78801443 0.71361471 4.85686925
## 3   0.13333  0.000000e+00 3.44439880 1.95760268 3.45911321
## 4   0.25000  0.000000e+00 2.89112140 2.44724351 2.87216298
## 5   0.75000 -1.893731e-22 2.57012392 2.59916777 2.53607607
## 6   2.00000  4.165132e-23 2.37376473 2.40582726 2.33991713
## 7   4.00000 -7.560877e-23 2.06637474 2.09788827 2.03311362
## 8   6.00000  1.509682e-22 1.76512651 1.79594315 1.73261061
## 9   8.00000  1.310328e-22 1.47179246 1.50170270 1.44024713
## 10 20.00000  2.928280e-24 0.14272172 0.15381219 0.13129230
## 11 23.00000 -1.079337e-23 0.04295274 0.04715076 0.03868535
```

```r
Times2 = c(0, dPK09[dPK09[,"CMT"]==2,"TIME"]) # oral dosing
iTime2 = 2:length(Times2)
lsoda(y=c(0.38*Dpo, 0, 0, 0), times=Times2, func=poPKde, parms=c(Vc=0.34, Cld=1.84, Vt=0.38, Vmax=0.13, Km=0.31, Ka=11.3, Tlag=0.062))
```

```
##        time             1         2          3         4
## 1   0.00000  2.280000e+00 0.0000000 0.00000000 0.0000000
## 2   0.08333  1.791667e+00 0.9725510 0.04167281 6.9633459
## 3   0.25000  2.724704e-01 3.6085169 1.75268955 4.5749284
## 4   0.50000  1.616015e-02 3.1333537 2.84775750 3.1646655
## 5   1.00000  5.692786e-05 2.9157185 2.94491720 2.8814245
## 6   2.00000  7.891800e-10 2.7558927 2.78848362 2.7214812
## 7   4.00000  5.923373e-11 2.4426752 2.47484400 2.4087143
## 8   6.00000 -2.754964e-11 2.1341061 2.16575251 2.1007031
## 9   8.00000  3.453672e-11 1.8313651 1.86235200 1.7986670
## 10 23.00000 -2.603293e-13 0.1164369 0.12600530 0.1066041
```

```r
fPK09 = function(THETA)
{
  Ka   = THETA[1]
  Vc   = THETA[2]
  Vt   = THETA[3]
  Km   = THETA[4]
  Vmax = THETA[5]
  Cld  = THETA[6]
  Tlag = THETA[7]
  Fa   = THETA[8]

  Fs1 = lsoda(y=c(0, 0, 0, 0), times=Times1, func=ivPKde, parms=c(Ka=Ka, Vc=Vc, Vt=Vt, Km=Km, Vmax=Vmax, Cld=Cld, Tlag=Tlag))
  Fs2 = lsoda(y=c(Fa*Dpo,0, 0, 0), times=Times2, func=poPKde, parms=c(Ka=Ka, Vc=Vc, Vt=Vt, Km=Km, Vmax=Vmax, Cld=Cld, Tlag=Tlag))
  return(c(Fs1[iTime1,3], Fs2[iTime2,3]))
}

nlr(fPK09, dPK09, pNames=c("Ka", "Vc", "Vt", "Km", "Vmax", "Cld", "Tlag", "Fa"),
     IE=c(10, 0.4, 0.6, 0.3, 0.1, 2, 0.08, 0.5),
     LB=c(0, 0.001, 0.001, 0, 0, 0, 0, 0),
     UB=c(30, 1, 2, 1, 1, 4, 1, 1), Error="P")
```

```
## $Est
##            Ka         Vc        Vt          Km        Vmax        Cld
## PE  11.919312 0.33921933 0.3887430  0.19659989 0.113250071  1.8714891
## SE   3.341325 0.03010223 0.0310253  0.03329911 0.004172073  0.4031147
## RSE 28.032867 8.87397156 7.9809296 16.93750243 3.683947018 21.5397846
##           Tlag          Fa   PropErrVar    PropErrSD
## PE  0.06302242 0.373412539  0.003270159  0.057185302
## SE  0.00473549 0.003802281  0.001081222  0.009453668
## RSE 7.51397765 1.018252048 33.063278466 16.531639233
## 
## $Cov
##                       Ka            Vc            Vt            Km
## Ka          1.116445e+01 -7.944060e-03 -2.813354e-03  4.151512e-02
## Vc         -7.944060e-03  9.061441e-04 -8.301650e-04 -2.219115e-04
## Vt         -2.813354e-03 -8.301650e-04  9.625695e-04  2.422184e-05
## Km          4.151512e-02 -2.219115e-04  2.422184e-05  1.108831e-03
## Vmax        5.022977e-03 -2.692450e-05  6.709727e-06  1.376981e-04
## Cld         6.410176e-01 -8.678157e-03  6.766576e-03  6.047723e-03
## Tlag        1.483788e-02 -4.990407e-05  3.310295e-05  6.621036e-05
## Fa          1.839990e-03 -1.324406e-05  1.525364e-05  7.711388e-05
## PropErrVar -5.348529e-05  6.353683e-07  5.107202e-07 -7.482762e-07
##                     Vmax           Cld          Tlag            Fa
## Ka          5.022977e-03  6.410176e-01  1.483788e-02  1.839990e-03
## Vc         -2.692450e-05 -8.678157e-03 -4.990407e-05 -1.324406e-05
## Vt          6.709727e-06  6.766576e-03  3.310295e-05  1.525364e-05
## Km          1.376981e-04  6.047723e-03  6.621036e-05  7.711388e-05
## Vmax        1.740619e-05  7.318053e-04  8.074816e-06  1.059870e-05
## Cld         7.318053e-04  1.625015e-01  1.199771e-03  3.599079e-04
## Tlag        8.074816e-06  1.199771e-03  2.242487e-05  3.558028e-06
## Fa          1.059870e-05  3.599079e-04  3.558028e-06  1.445734e-05
## PropErrVar -5.877126e-08 -6.213963e-06 -8.008231e-08 -1.542744e-08
##               PropErrVar
## Ka         -5.348529e-05
## Vc          6.353683e-07
## Vt          5.107202e-07
## Km         -7.482762e-07
## Vmax       -5.877126e-08
## Cld        -6.213963e-06
## Tlag       -8.008231e-08
## Fa         -1.542744e-08
## PropErrVar  1.169040e-06
## 
## $run
## $run$m
## [1] 8
## 
## $run$n
## [1] 11
## 
## $run$run
## [1] 11
## 
## $run$p.value
## [1] 0.4533222
## 
## 
## $AIC
## [1] -22.23973
## 
## $AICc
## [1] -2.239728
```

```r
nlr(fPK09, dPK09, pNames=c("Ka", "Vc", "Vt", "Km", "Vmax", "Cld", "Tlag", "Fa"),
     IE=c(10, 0.4, 0.6, 0.3, 0.1, 2, 0.08, 0.5),
     LB=c(0, 0.001, 0.001, 0, 0, 0, 0, 0),
     UB=c(30, 1, 2, 1, 1, 4, 1, 1))
```

```
## $Est
##            Ka         Vc         Vt          Km        Vmax        Cld
## PE  10.371225 0.34342421 0.41845115  0.06814838 0.101592928  1.7525004
## SE   1.596033 0.01427099 0.02181435  0.05365431 0.006652001  0.2082989
## RSE 15.389049 4.15549809 5.21311783 78.73160672 6.547700654 11.8858141
##           Tlag          Fa    AddErrVar    AddErrSD
## PE  0.06134590 0.388744437  0.014039113  0.11848676
## SE  0.00348485 0.009041967  0.004566082  0.01926832
## RSE 5.68065728 2.325941090 32.524007631 16.26200382
## 
## $Cov
##                      Ka            Vc            Vt            Km
## Ka         2.547321e+00 -2.930849e-04 -1.048839e-02  2.987333e-03
## Vc        -2.930849e-04  2.036611e-04 -1.642896e-04 -5.551213e-05
## Vt        -1.048839e-02 -1.642896e-04  4.758659e-04 -1.481261e-04
## Km         2.987333e-03 -5.551213e-05 -1.481261e-04  2.878785e-03
## Vmax      -2.522480e-04 -9.574126e-06 -2.229682e-05  2.740484e-04
## Cld        1.090591e-01 -2.154406e-03  1.022515e-03  1.649962e-03
## Tlag       3.908949e-03 -9.782724e-06 -4.420213e-06  8.654417e-06
## Fa        -6.529838e-03  8.602229e-07  1.044742e-04  2.457939e-05
## AddErrVar -5.227363e-05  8.240060e-08  1.850543e-07 -4.776006e-07
##                    Vmax           Cld          Tlag            Fa
## Ka        -2.522480e-04  1.090591e-01  3.908949e-03 -6.529838e-03
## Vc        -9.574126e-06 -2.154406e-03 -9.782724e-06  8.602229e-07
## Vt        -2.229682e-05  1.022515e-03 -4.420213e-06  1.044742e-04
## Km         2.740484e-04  1.649962e-03  8.654417e-06  2.457939e-05
## Vmax       4.424911e-05  2.783259e-04  5.407168e-07  1.305399e-05
## Cld        2.783259e-04  4.338845e-02  2.692066e-04 -4.123995e-05
## Tlag       5.407168e-07  2.692066e-04  1.214418e-05 -7.175668e-06
## Fa         1.305399e-05 -4.123995e-05 -7.175668e-06  8.175716e-05
## AddErrVar -2.490820e-08 -3.920023e-06 -9.017367e-08  1.075534e-07
##               AddErrVar
## Ka        -5.227363e-05
## Vc         8.240060e-08
## Vt         1.850543e-07
## Km        -4.776006e-07
## Vmax      -2.490820e-08
## Cld       -3.920023e-06
## Tlag      -9.017367e-08
## Fa         1.075534e-07
## AddErrVar  2.084911e-05
## 
## $run
## $run$m
## [1] 9
## 
## $run$n
## [1] 10
## 
## $run$run
## [1] 7
## 
## $run$p.value
## [1] 0.0767174
## 
## 
## $AIC
## [1] -9.178548
## 
## $AICc
## [1] 10.82145
```

```r
nlr(fPK09, dPK09, pNames=c("Ka", "Vc", "Vt", "Km", "Vmax", "Cld", "Tlag", "Fa"), IE=c(10, 0.4, 0.6, 0.3, 0.1, 2, 0.08, 0.5), Error="C")
```

```
## Warning in sqrt(diag(e$Cov)): NaNs produced
```

```
## Warning in sqrt(1/diag(V)): NaNs produced
```

```
## Warning in cov2cor(e$Cov): diag(.) had 0 or NA entries; non-finite result
## is doubtful
```

```
## Error in eigen(e$Correl): infinite or missing values in 'x'
```

```r
e$PE
```

```
##  [1] 1.190532e+01 3.440102e-01 3.895294e-01 1.681051e-01 1.101395e-01
##  [6] 1.768973e+00 6.281812e-02 3.732787e-01 5.447203e-05 3.451288e-03
```

```r
wnl5(fPK09, dPK09, pNames=c("Ka", "Vc", "Vt", "Km", "Vmax", "Cld", "Tlag", "Fa"), IE=c(10, 0.4, 0.6, 0.3, 0.1, 2, 0.08, 0.5), Error="P")
```

```
## $PE
##          Ka          Vc          Vt          Km        Vmax         Cld 
## 10.41419059  0.34329904  0.41811580  0.07354451  0.10206254  1.75701281 
##        Tlag          Fa 
##  0.06141786  0.38868737 
## 
## $WRSS
## [1] 0.2660963
## 
## $run
## $run$m
## [1] 9
## 
## $run$n
## [1] 10
## 
## $run$run
## [1] 7
## 
## $run$p.value
## [1] 0.0767174
## 
## 
## $AIC
## [1] -9.154042
## 
## $SBC
## [1] -1.598531
```

